const F=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}};F();var E=Object.defineProperty,M=(o,e,r)=>e in o?E(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,c=(o,e,r)=>(M(o,typeof e!="symbol"?e+"":e,r),r);const O=o=>{if(o.length===0)return[];const[e,...r]=o;return[...e].filter(t=>{for(const i of r)if(!i.has(t))return!1;return!0})},y=o=>[...new Set(o.map(r=>[...r]).flat())],b=()=>Date.now();let h=0,v=b();function _(){return h++,h===Number.MAX_SAFE_INTEGER&&(h=0,v=b()),`${v.toString(16)}-${h.toString(16)}`}function R(o,e){const r=new Set;for(;r.size<o&&r.size!==e.length;)r.add(e[Math.floor(Math.random()*e.length)]);return[...r]}class A{constructor(e,r){c(this,"context"),c(this,"components"),c(this,"entities",{}),c(this,"componentAll",{}),c(this,"systems",{}),c(this,"entityRemove",new Set),c(this,"componentRemove",{}),c(this,"componentQueries",{}),c(this,"queries",{}),c(this,"updatedQueries",new Set),this.context=e,this.components=r;for(const t in r)this.componentAll[t]=new Set,this.componentRemove[t]=new Set,this.componentQueries[t]=new Set}createEntity(e,r){const t=_(),i={__uuid:t};return e&&e.forEach(n=>this.addComponent(i,n,r?r[n]:void 0)),this.entities[t]=i,i}removeEntity(e){if(!!e){this.entityRemove.add(e.__uuid);for(const r of Object.keys(e))r!=="__uuid"&&this.removeComponent(e,r)}}addComponent(e,r,t){const i=Object.assign({},this.components[r],t!=null?t:{});return e[r]=i,this.componentAll[r].add(e.__uuid),this.updateComponents(r,e.__uuid,"added"),e}removeComponent(e,r){this.componentAll[r].delete(e.__uuid),this.componentRemove[r].add(e.__uuid),this.updateComponents(r,e.__uuid,"removed")}createQuery(e){const r=_(),t={__uuid:r,executed:!1,changed:!0,names:e,entity_ids:new Set,entity_added:new Set,entity_removed:new Set,filters:{},filters_added:{},filters_removed:{}};for(const n of e)t.filters[n]=new Set,t.filters_added[n]=new Set,t.filters_removed[n]=new Set,this.componentAll[n].forEach(s=>{t.filters[n].add(s),t.filters_added[n].add(s)});this.queries[r]=t,e.forEach(n=>this.componentQueries[n].add(r));const i=()=>{t.executed=!0,t.changed&&(this.updateQuery(t),t.changed=!1)};return{added:()=>(i(),t.entity_added),removed:()=>(i(),t.entity_removed),entities:()=>(i(),[...t.entity_ids].map(n=>this.entities[n])),random:n=>(i(),R(n,[...t.entity_ids]).map(s=>this.entities[s]))}}addSystem(e,r){const t=r(this);return t.mounted&&t.mounted(),this.systems[e]||(this.systems[e]=[]),this.systems[e].push(t),this.systems[e].sort((i,n)=>(i.priority||1)-(n.priority||1)),r}updateSystems(e,r){const i=(Array.isArray(e)?e:[e]).map(n=>this.systems[n]).flat();for(const n of i)n.update&&n.update(r)}updateQuery(e){e.entity_ids=new Set(O(Object.values(e.filters))),e.entity_added=new Set(y(Object.values(e.filters_added)).filter(r=>e.entity_ids.has(r))),e.entity_removed=new Set(y(Object.values(e.filters_removed)).filter(r=>e.entity_ids.has(r)))}updateComponents(e,r,t){const i=r instanceof Set?r:new Set([r]);if(i.size===0)return;const n=e;for(const s of this.componentQueries[n]){const l=this.queries[s];for(const p of i)l.filters[n].add(p),t==="added"?(l.filters_added[n].add(p),this.updatedQueries.add(s),l.changed=!0):t==="removed"&&(l.filters_removed[n].add(p),this.updatedQueries.add(s),l.changed=!0)}}cleanup(){this.updatedQueries.clear();for(const e of Object.values(this.queries))!e.executed||(Object.values(e.filters_added).forEach(r=>{r.size!==0&&(this.updatedQueries.add(e.__uuid),r.clear())}),Object.values(e.filters_removed).forEach(r=>{r.size!==0&&(this.updatedQueries.add(e.__uuid),r.clear())}));for(const e in this.components){const r=this.componentRemove[e];r.size!==0&&(r.forEach(t=>{this.componentQueries[e].forEach(n=>{this.queries[n].filters[e].delete(t),this.updatedQueries.add(n)});const i=this.entities[t];delete i[e]}),r.clear())}if(this.entityRemove.size>0){for(const e of this.entityRemove)delete this.entities[e];this.entityRemove.clear()}for(const e of this.updatedQueries)this.updateQuery(this.queries[e])}}function C(o,e){return new A(o,e)}const u=document.createElement("canvas");u.width=1280;u.height=720;u.style.background="transparent";const d=u.getContext("2d");var S;(S=document.getElementById("app"))==null||S.appendChild(u);if(!d)throw new Error("");function f(){let o="#";for(let e=0;e<3;e++)o+=Math.floor(Math.random()*255).toString(16).padStart(2,"0");return o}function x(o){const e=d.createLinearGradient(0,0,1e3,1e3),r=o.length;let t=0;for(let i of o)e.addColorStop(t/(r-1),i),t++;return e}const P={rect:{x:0,y:0,w:100,h:100,colors:["#FFFFFF","#000000"]},disc:{x:0,y:0,r:50,colors:["#FFFFFF","#000000"]},move:{dx:0,dy:0}},a=C({},P);a.addSystem("move",()=>{const o=a.createQuery(["rect","move"]),e=a.createQuery(["disc","move"]);return{name:"",update(r){for(const t of o.entities())t.rect.x+=t.move.dx*r,t.rect.y+=t.move.dy*r,(t.rect.x<0||t.rect.x>1280-t.rect.w)&&(t.move.dx*=-1),(t.rect.y<0||t.rect.y>720-t.rect.h)&&(t.move.dy*=-1);for(const t of e.entities())t.disc.x+=t.move.dx*r,t.disc.y+=t.move.dy*r,(t.disc.x<0||t.disc.x>1280-t.disc.r)&&(t.move.dx*=-1),(t.disc.y<0||t.disc.y>720-t.disc.r)&&(t.move.dy*=-1)}}});a.addSystem("render",()=>{const o=a.createQuery(["rect"]);return{name:"",update(){for(const e of o.entities())d.beginPath(),d.fillStyle=x(e.rect.colors),d.fillRect(e.rect.x,e.rect.y,e.rect.w,e.rect.h),d.stroke()}}});a.addSystem("render",()=>{const o=a.createQuery(["disc"]);return{name:"",update(){for(const e of o.entities())d.beginPath(),d.fillStyle=x(e.disc.colors),d.arc(e.disc.x,e.disc.y,e.disc.r,0,2*Math.PI),d.fill()}}});const g=()=>[f(),f(),f(),f(),f()],m=()=>Math.random()*250+200;for(let o=0;o<50;o++)a.createEntity(["rect","move"],{rect:{x:m(),y:m(),colors:g()},move:{dx:Math.random()-.5,dy:Math.random()-.5}}),a.createEntity(["disc","move"],{disc:{x:m(),y:m(),r:Math.random()*60+10,colors:g()},move:{dx:Math.random()-.5,dy:Math.random()-.5}});let w=0;const Q=o=>{const e=o-w;w=o,d.clearRect(0,0,u.width,u.height),a.updateSystems(["move","render"],e),requestAnimationFrame(Q)};Q(0);
